##Update the URL to the .7z archive##

$url = "https://kali.cs.nycu.edu.tw/kali-images/kali-2025.2/kali-linux-2025.2-hyperv-amd64.7z"
$destination = "$env:USERPROFILE\Downloads\kali-2025.2-hyperv.7z"
Invoke-WebRequest -Uri $url -OutFile $destination

##Extract the .vhdx from the archive##

$sevenZipPath = "C:\Program Files\7-Zip\7z.exe"
$archive = "$env:USERPROFILE\Downloads\kali-2025.2-hyperv.7z"
$extractTo = "$env:USERPROFILE\Downloads\KaliExtracted"

Start-Process -FilePath $sevenZipPath -ArgumentList "x `"$archive`" -o`"$extractTo`"" -Wait

###Create and configure the VM##

$vmName = "KaliLinux"
$vmPath = "$env:USERPROFILE\Hyper-V\$vmName"
New-VM -Name $vmName -MemoryStartupBytes 4GB -Generation 2 -VHDPath $destination -Path $vmPath
Set-VMProcessor $vmName -ExposeVirtualizationExtensions $true
Add-VMNetworkAdapter -VMName $vmName -SwitchName "Default Switch"
Start-VM -Name $vmName


